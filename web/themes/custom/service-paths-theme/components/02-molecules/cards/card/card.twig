{#
 # Available variables:
 # - card__base_class - base classname of the wrapper.
 # - card__modifiers - array of modifiers to add to the base classname of the wrapper.
 # - card__blockname - blockname prepended to the base classname of the wrapper(s) and each component.
 #
 # - card__image - card image.
 #
 # - card__image__modifiers - array of modifiers to add to the base classname of the wrapper.
 # - card__image__src - image file location.
 #
 # - card__heading: 'Ty√∂llisyys ja oppiminen puhuttavat kansanedustaja Mia Laihon vierailulla'
 #
 # - card__content__base_class - base classname of the copy wrapper - defaults to 'heading'.
 # - card__content__modifiers - array of modifiers to add to the base classname of the copy wrapper.
 # - card__content__blockname - blockname prepended to the base classname of the copy wrapper.
 #
 # - card__heading - the content of the title component.
 # - card__heading__base_class - base classname of the title component. Defaults to "title".
 # - card__heading__blockname - blockname to add to the base classname of the title - defaults to card__base_class.
 # - card__heading__modifiers - array of modifiers to add to the base classname of the title.
 # - card__heading__link_base_class - base class to add to the title link - defaults to 'title-link'.
 #
 # - card__link__url - the url the title should link to.
 # - card__link__external - boolean set to true if link is external. Defaults to false.
 #
 # - card__type - card type
 # - card__category - card category
 # - card__date - card date
 #
 # - card__label - the content of the subtitle component.
 # - card__label__link - (optional) the url the subtitle should link to.
 # - card__label__base_class - base classname of the subtitle component. Defaults to "subtitle".
 # - card__label__modifiers - array of modifiers to add to the base classname of the subtitle.
 #
 #}
{% set card__base_class = 'card' %}
{% set card__type = card__type|default() %}
{% set card__modifiers = card__modifiers|default([]) %}
{% set card__extra_classes = card__extra_classes|default([]) %}
{% set card__image__modifiers = card__image__modifiers|default([]) %}

{% if not card__image__src %}
  {% set card__image__modifiers = ['default'] %}
{% endif %}

{% set card__link__modifiers = card__link__modifiers|default([]) %}
{% if card__link__external %}
  {% set card__link__modifiers = card__link__modifiers|merge(['external']) %}
{% endif %}

{% set card__has_category = card__category|render|trim is not empty %}

{% set meta_type__modifier = ['dark'] %}
{% if 'small' in card__modifiers %}
  {% set meta_type__modifier = ['light'] %}
{% endif %}

{% set meta_content = [] %}
{% if card__type %}
  {% set meta_content = meta_content|merge([card__type]) %}
{% endif %}
{% if card__date %}
  {% set meta_content = meta_content|merge([card__date]) %}
{% endif %}

<div {{ bem(card__base_class, card__modifiers, card__blockname, card__extra_classes) }}>
  <div {{ bem('text', card__modifiers, card__base_class) }} >
    {# Heading #}
    {% if card__heading and not card__arrow %}
      {{ title_prefix }}
      {% include "@atoms/text/heading/heading.twig" with {
        heading__level: 3,
        heading__base_class: card__heading__base_class|default('heading'),
        heading__modifiers: card__heading__modifiers,
        heading__blockname: card__base_class,
        heading: card__heading,
        heading__url: card__link__url,
        heading__link_base_class: card__heading__link_base_class|default('heading-link'),
        heading__link_blockname: card__base_class,
      } %}
      {{ title_suffix }}
    {% endif %}

    {# Type #}
    {% if card__has_category %}
      {% include "@atoms/text/meta/meta.twig" with {
        meta__extra_classes: ['card__category'],
        meta__content: [card__category],
        meta__separator: ','
      } %}
    {% endif %}
  </div>

  {# Image #}
  <div {{ bem('image', card__image__modifiers, card__base_class) }} aria-hidden="true" role="presentation">

    {% if card__image__src %}
      {% include "@atoms/images/image/image.twig" with {
        image_src: card__image__src,
      } %}
    {% endif %}

    {% if card__image %}
      {{ card__image }}
    {% endif %}
  </div>

  {% if meta_content %}
    {% include "@atoms/text/meta/meta.twig" with {
      meta__modifiers: meta_type__modifier,
      meta__extra_classes: ['card__type'],
      meta__content: meta_content,
      meta__separator: '|',
    } %}
  {% endif %}
</div>
